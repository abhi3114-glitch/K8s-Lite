# K8s-Lite: A Lightweight Kubernetes Implementation from Scratch

K8s-Lite is a simplified, educational implementation of Kubernetes, written in Go. It mimics the core architecture and components of K8s to demonstrate how container orchestration works under the hood.

## Architecture

The project consists of the following components:

- **API Server** (`apiserver`): The central control plane component. Exposes a REST API for resources (Pods, Nodes, etc.).
- **Controller Manager** (`controller-manager`): Runs control loops (ReplicaSet, Deployment, Service, Leader Election).
- **Scheduler** (`scheduler`): Assigns unscheduled pods to nodes based on resource availability.
- **Kubelet** (`kubelet`): The node agent that manages containers (via Docker) and reports node status.
- **Proxy** (`proxy`): Manages network rules (services) on the node.

## Features

- **Pod Lifecycle**: Create, update, delete pods.
- **ReplicaSets**: Ensure n replicas of a pod are running.
- **Deployments**: Rolling updates and rollbacks.
- **Services**: Service discovery and load balancing (ClusterIP).
- **Scheduling**: Basic resource-based scheduling.
- **Security**: mTLS authentication between components.
- **High Availability**: Leader election for Controller Manager.
- **Persistence**: File-based storage (BadgerDB backed).
- **Observability**: Prometheus metrics.

## Prerequisites

- Go 1.21+
- Docker Desktop (running)
- PowerShell (for scripts)

*   **Go**: Version 1.23 or higher.
*   **Docker**: Required for Kubelet to run actual containers (optional if running in simulation mode).
*   **PowerShell**: Required for running the provided startup and verification scripts on Windows.

## Installation and Build

The project includes a Makefile-like build process via PowerShell. You can build all binaries using the verification script or manually.

To build manually:
```bash
go build -o bin/apiserver.exe ./cmd/apiserver
go build -o bin/controller-manager.exe ./cmd/controller-manager
go build -o bin/scheduler.exe ./cmd/scheduler
go build -o bin/kubelet.exe ./cmd/kubelet
go build -o bin/proxy.exe ./cmd/proxy
```

## Getting Started

### 1. Start the Cluster
A helper script is provided to launch a secure, multi-component cluster on your local machine. This script generates necessary TLS certificates and starts the API Server, specific Controllers, Kubelet, and Proxy.

```powershell
.\start_cluster_secure.ps1
```

This will:
*   Generate `ca.pem`, `server.pem`, `client-*.pem` certificates if they do not exist.
*   Start **API Server** on `https://localhost:8080`.
*   Start **Controller Manager** (with Leader Election enabled).
*   Start **Kubelet** (registering as `node1`).
*   Start **Proxy**.

### 2. Verify Connectivity
Once the cluster is running, you can verify the status of the node or pods. Since mTLS is enabled, you must use the generated client certificates.

The project provides a Go-based verification tool used in the E2E suite:
```bash
go run hack/verify-connect/main.go
```

Or using `curl` (ensure you have the certificates generated by the startup script):
```bash
curl -k --cert client-admin.pem --key client-admin.key --cacert ca.pem https://localhost:8080/api/v1/nodes
```

### 3. Run Production Verification
To validate the entire system's readiness, including build, security, functional logic (Deployment creation, Pod scheduling), and HA failover, run the comprehensive verification suite:

```powershell
.\hack\verify_production_readiness.ps1
```

This script is the definitive sanity check for the codebase.

## Directory Structure

*   `cmd/`: Main applications for this project (the binaries).
*   `internal/`: Private application and library code.
    *   `api/`: API type definitions.
    *   `apiserver/`: HTTP server implementation.
    *   `client/`: Go client library for the internal API.
    *   `leaderelection/`: Leader election logic.
    *   `scheduler/`: Scheduling logic.
*   `hack/`: Scripts and tools for development and verification.
    *   `e2e/`: End-to-End testing logic in Go.
    *   `gen-certs/`: Certificate generation utility.
- `docs/`: Documentation.

## License
MIT







